# auth
Auth server built on express js

## Usage

```
cp .env.sample .env
docker-compose up -d
```

## Endpoints

### `POST /auth`

Request to authorize user

#### Request

```
{
  "pid": "Public ID of the user",
  "cid": "Client ID"
}
```

#### Response

```
{
  "pid": "Public ID of the user",
  "cid": "Client ID",
  "secret": "Secret key associated with current client of the user"
}
```

Note: secret key shall never be passed to the client and shall be used to verify token or session instead.

---

### `PUT /auth`

Request to extend secret expiration time. Calculated from the time of request and until `$CLIENT_TTL` that can be configured in `.env` file. This request shall be made **only** after successful verification of the user.

#### Request

```
{
  "cid": "Client ID"
}
```

#### Response

```
200 OK
```

---

### `POST /signup`

Request to sign up the user.

#### Request

```
{
    "email": "User's email",
    "password": "User's password",
    "pid": "Public ID of the user"
}
```

Note: public ID of the user shall always be generated by client and passed through to authorization server.

#### Response

```
{
  "pid": "Public ID of the user",
  "cid": "Client ID",
  "secret": "Secret key associated with current client of the user"
}
```

Authorization server will generate two keys:
- Client ID, a public key that shall be passed to the client
- Secret, a secret key that shall never be passed to client and be used to sign token or session id.

Note: authorization server will not send back an email

---

### `POST /login`

Request to log in the user.

#### Request

```
{
    "email": "User's email",
    "password": "User's password"
}
```

#### Response

```
{
  "pid": "Public ID of the user",
  "cid": "Client ID",
  "secret": "Secret key associated with current client of the user"
}
```

---

### `POST /logout`
### `POST /logout?scope=everywhere`

Request to log out the user. Use `scope=everywhere` query to destroy all client keys associated with the user. 

#### Request

```
{
  "cid": "Client ID"
}
```

#### Response

```
{
  "cid": null
}
```

Every response with `cid` value equal to `null` shall be considered as logout action and user shall be redirected from private route immediatelly.

---

### `POST /reset`

Request to reset user's password.

#### Request

```
{
  "email": "User's email"
}
```

#### Response

```
{
  "email": "User's email",
  "pid": "Public ID of the user",
  "cid": "Client ID",
  "secret": "Secret key associated with current client of the user"
}
```

Note: this is the only response containing user email, suggesting that data from the response **shall never be sent to client directly**, but sent via email in the form of password reset link!

Make sure that token generated with `secret` is scoped exclusively to reset password link, authorization server **will not** do that for you and will treat all authorization requests equally!

Note: secret expiration time for password reset requests by default set up to 1 hour, you can change this behaviour with `$PASSWORD_TTL` variable in `.env` file.
